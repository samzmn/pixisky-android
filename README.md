# Pixisky Android Application

#### Video Demo:  [Watch Here](https://youtu.be/8LSiHZjQKe4)

#### Description:
Pixisky is an Android application designed to complement the Pixisky.com platform. It provides users with interactive features to enhance their experience with night sky maps and associated multimedia.

The application's main screen features four buttons, two of which are currently functional, while the other two are under development:
1. **Design Button**: Redirects users to the [Pixisky Design](https://pixisky.com/design) webpage, where they can create customizable night sky maps based on a specific location and date. These maps can be printed on canvas and ordered directly from the website.
2. **QR-Code Scan Button**: Activates the device's camera to scan QR codes, particularly those generated by Pixisky.com. These QR codes link to audio files uploaded by users during the map creation process. If a valid link is detected, the application opens the audio file in an embedded media player and plays it. If the QR code contains other types of content, the app simply displays the content.

The application is built using Kotlin in Android Studio and integrates multiple modern technologies such as Jetpack Compose, CameraX, ML Kit, and ExoPlayer to deliver a seamless user experience.

---

## Files and Functionality

1. **app/src/main/java/com/pixisky/app/MainActivity.kt**  
   - **Purpose**: Serves as the main entry point of the application and controls the core functionality.  
   - **Highlights**:
     - Handles permissions for camera, storage, and internet access.
     - Implements the main Compose UI layout using `PixiSkyTheme`.
     - Manages permission dialogs and redirects users to app settings if permissions are denied.
     - Launches the QR code scanning functionality and integrates the design button for Pixisky.com.

2. **app/src/main/java/com/pixisky/app/ui/AudioPlayerScreen.kt**  
   - **Purpose**: Provides a rich user interface for audio playback functionality.  
   - **Highlights**:
     - Utilizes ExoPlayer for robust audio playback, including loading and error handling states.
     - Handles dynamic state transitions, such as `Loading`, `Error`, and `Success`, based on the audio file retrieval results.
     - Offers a media player view with controls for audio playback, enriched with default artwork and player settings.
     - Includes composable functions for error screens, loading screens, and a fully-featured media player experience.

3. **app/src/main/java/com/pixisky/app/PermissionManager.kt**  
   - **Purpose**: Manages permissions required by the application, ensuring users grant access to essential functionalities.  
   - **Highlights**:
     - Checks for camera, storage, and internet permissions using `ContextCompat.checkSelfPermission`.
     - Requests permissions using `ActivityCompat.requestPermissions` with predefined request codes.
     - Streamlines permission handling to ensure the app functions smoothly without interruptions.

4. **app/src/main/java/com/pixisky/app/PixiSkyApplication.kt**  
   - **Purpose**: Serves as the top-level application class, providing dependencies and managing app-wide operations.  
   - **Highlights**:
     - Utilizes the `AppContainer` and `AppDataContainer` for dependency management.
     - Centralizes dependencies to be accessed across the application.
     - Implements a top-level composable function, `PixiSkyApp`, to represent the app's screens and navigation.
     - Introduces `PixiSkyAppBar` for consistent app bar navigation with back-button support.

5. **app/src/main/java/com/pixisky/app/data/AppDataContainer.kt**  
   - **Purpose**: Implements dependency injection by managing the application's data and services in a centralized manner.  
   - **Highlights**:
     - Defines the `AppContainer` interface to provide instances of repositories like `PixiRepository` and `AudioRepository`.
     - Configures Retrofit to communicate with the Pixisky API at `http://pixisky.com`.
     - Lazily initializes repositories (`OfflinePixiRepository` and `NetworkAudioRepository`) for efficient resource utilization.
     - Integrates with the local database (`PixiDatabase`) and an API service (`AudioApiService`) for seamless data handling.

6. **app/src/main/java/com/pixisky/app/data/NetworkAudioRepository.kt**  
   - **Purpose**: Handles network interactions for audio file retrieval through the Pixisky API.  
   - **Highlights**:
     - Implements the `AudioRepository` interface to fetch audio data from a given URL.
     - Modifies URLs with specific prefixes to comply with Pixisky application standards.
     - Uses Retrofit to communicate with the `AudioApiService`, executing requests to retrieve audio files.
     - Efficiently manages API calls and processes responses using `Response<ResponseBody>`.

7. **app/src/main/java/com/pixisky/app/network/AudioApiService.kt**  
   - **Purpose**: Defines the API endpoints for audio file retrieval from the Pixisky platform.  
   - **Highlights**:
     - Provides a method, `getAudio`, to fetch audio files via HTTP requests.
     - Implements streaming functionality to handle large audio files efficiently using Retrofit annotations like `@Streaming` and `@GET`.
     - Supports dynamic URLs with `@Url` parameters for flexible endpoint access.

8. **app/src/main/java/com/pixisky/app/ui/navigation/NavigationDestination.kt**  
   - **Purpose**: Establishes an abstract structure for defining navigation destinations within the app.  
   - **Highlights**:
     - Specifies a `route` property to uniquely identify composable destinations.
     - Includes a `titleRes` property for associating string resources with screen titles.
     - Serves as the foundation for organizing and managing app navigation.

9. **app/src/main/java/com/pixisky/app/ui/navigation/PixiSkyNavHost.kt**  
   - **Purpose**: Defines the navigation host, mapping routes to their corresponding composable screens.  
   - **Highlights**:
     - Configures the navigation structure for the app, starting with the `HomeDestination`.
     - Implements the routing for QR code scanning and handling QR code results dynamically.
     - Uses `NavHostController` to manage the app's navigation and backstack entries.
     - Encodes and decodes QR code URLs for seamless routing between screens.

10. **app/src/main/java/com/pixisky/app/ui/HomeScreen.kt**  
    - **Purpose**: Implements the home screen with navigation buttons for accessing various app functionalities.  
    - **Highlights**:
        - Uses `PixiSkyAppBar` for a polished and consistent app bar design.
        - Integrates navigation buttons for QR code scanning, Pixisky Design, and future features like "Live Sky" and "Pixi Art."
        - Displays a visually appealing background image (`starry_background`) for an immersive user experience.
        - Navigation buttons are designed with rounded edges and semi-transparent backgrounds for a modern UI.

11. **app/src/main/java/com/pixisky/app/ui/PixiViewModel.kt**  
    - **Purpose**: Manages the state and logic for audio-related functionality in the app's UI.  
    - **Highlights**:
        - Defines multiple UI states (`PixiAudioUiState`) such as `Loading`, `Error`, `Failure`, and `Success` for dynamic user feedback.
        - Integrates with `AudioRepository` to fetch audio files via HTTP and save them locally.
        - Handles storage permission requests and ensures smooth error handling when permissions are not granted.
        - Incorporates a factory pattern (`Factory`) for ViewModel instantiation, utilizing dependency injection from the `PixiSkyApplication`.

12. **app/src/main/java/com/pixisky/app/ui/QrCodeResultScreen.kt**  
    - **Purpose**: Processes QR code scan results and determines appropriate actions based on the URL.  
    - **Highlights**:
        - Validates URLs and distinguishes between audio-related QR codes (`pixiskyaudioqrcode`) and other types.
        - Redirects audio QR codes to `AudioPlayerScreen` for playback after modifying the URL prefix to `pixiskyapplicationaudioqrcode`.
        - Routes non-audio QR codes to `ScanResultScreen`, displaying the raw URL content in an `OutlinedTextField` for user reference.

13. **app/src/main/java/com/pixisky/app/ui/QrCodeScreen.kt**  
    - **Purpose**: Facilitates QR code scanning using the device's camera and displays detected results.  
    - **Highlights**:
        - Integrates CameraX for high-performance and easy-to-use camera functionality.
        - Uses ML Kit for robust QR code detection and processing.
        - Provides a dynamic user interface:
            - Prompts users to grant camera permission if not already granted.
            - Displays a live camera preview to scan QR codes.
        - Implements a `BarcodeOverlay` composable to visually highlight detected QR codes with bounding boxes.
        - Routes detected QR code URLs to the appropriate handler function (`scanCode`).

---

## Features

- **Design Integration**: Direct access to Pixisky's design tools via the "Design" button.
- **QR-Code Scanning**: Scans QR codes to retrieve and play associated audio files or display their content.
- **Permission Management**: Ensures users grant necessary permissions for camera, storage, and internet access.
- **Navigation System**: Establishes navigation within the application using `PixiSkyNavHost` and `NavigationDestination`.
- **Dependency Injection**: Centralized management of data repositories and API services through `AppDataContainer`.
- **Audio File Management**: Fetches and processes audio files linked to QR codes using `NetworkAudioRepository`.
- **Audio Playback**: Rich audio playback experience using `Audio